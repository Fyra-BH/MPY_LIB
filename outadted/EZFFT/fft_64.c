#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include "ez_fft.h"

void fft_64(float* buff)
{
    complex_t* buff_c = (complex_t*)malloc(sizeof(complex_t) * 64);
    //将原序列的序号比特翻转，并存入临时数组
    for (size_t i = 0; i < 64; i++)
    {
        buff_c[i].re = *(buff + 2 * bit_reverse(i, 6));
        buff_c[i].im = *(buff + 2 * bit_reverse(i, 6) + 1);
    }
    complex_t w0 = W(64, 0);
    complex_t w1 = W(64, 1);
    complex_t w2 = W(64, 2);
    complex_t w3 = W(64, 3);
    complex_t w4 = W(64, 4);
    complex_t w5 = W(64, 5);
    complex_t w6 = W(64, 6);
    complex_t w7 = W(64, 7);
    complex_t w8 = W(64, 8);
    complex_t w9 = W(64, 9);
    complex_t w10 = W(64, 10);
    complex_t w11 = W(64, 11);
    complex_t w12 = W(64, 12);
    complex_t w13 = W(64, 13);
    complex_t w14 = W(64, 14);
    complex_t w15 = W(64, 15);
    complex_t w16 = W(64, 16);
    complex_t w17 = W(64, 17);
    complex_t w18 = W(64, 18);
    complex_t w19 = W(64, 19);
    complex_t w20 = W(64, 20);
    complex_t w21 = W(64, 21);
    complex_t w22 = W(64, 22);
    complex_t w23 = W(64, 23);
    complex_t w24 = W(64, 24);
    complex_t w25 = W(64, 25);
    complex_t w26 = W(64, 26);
    complex_t w27 = W(64, 27);
    complex_t w28 = W(64, 28);
    complex_t w29 = W(64, 29);
    complex_t w30 = W(64, 30);
    complex_t w31 = W(64, 31);
//第1轮运算
   butterfly_compu(&buff_c[0], &buff_c[1], w0);
   butterfly_compu(&buff_c[2], &buff_c[3], w0);
   butterfly_compu(&buff_c[4], &buff_c[5], w0);
   butterfly_compu(&buff_c[6], &buff_c[7], w0);
   butterfly_compu(&buff_c[8], &buff_c[9], w0);
   butterfly_compu(&buff_c[10], &buff_c[11], w0);
   butterfly_compu(&buff_c[12], &buff_c[13], w0);
   butterfly_compu(&buff_c[14], &buff_c[15], w0);
   butterfly_compu(&buff_c[16], &buff_c[17], w0);
   butterfly_compu(&buff_c[18], &buff_c[19], w0);
   butterfly_compu(&buff_c[20], &buff_c[21], w0);
   butterfly_compu(&buff_c[22], &buff_c[23], w0);
   butterfly_compu(&buff_c[24], &buff_c[25], w0);
   butterfly_compu(&buff_c[26], &buff_c[27], w0);
   butterfly_compu(&buff_c[28], &buff_c[29], w0);
   butterfly_compu(&buff_c[30], &buff_c[31], w0);
   butterfly_compu(&buff_c[32], &buff_c[33], w0);
   butterfly_compu(&buff_c[34], &buff_c[35], w0);
   butterfly_compu(&buff_c[36], &buff_c[37], w0);
   butterfly_compu(&buff_c[38], &buff_c[39], w0);
   butterfly_compu(&buff_c[40], &buff_c[41], w0);
   butterfly_compu(&buff_c[42], &buff_c[43], w0);
   butterfly_compu(&buff_c[44], &buff_c[45], w0);
   butterfly_compu(&buff_c[46], &buff_c[47], w0);
   butterfly_compu(&buff_c[48], &buff_c[49], w0);
   butterfly_compu(&buff_c[50], &buff_c[51], w0);
   butterfly_compu(&buff_c[52], &buff_c[53], w0);
   butterfly_compu(&buff_c[54], &buff_c[55], w0);
   butterfly_compu(&buff_c[56], &buff_c[57], w0);
   butterfly_compu(&buff_c[58], &buff_c[59], w0);
   butterfly_compu(&buff_c[60], &buff_c[61], w0);
   butterfly_compu(&buff_c[62], &buff_c[63], w0);
//第2轮运算
   butterfly_compu(&buff_c[0], &buff_c[2], w0);
   butterfly_compu(&buff_c[1], &buff_c[3], w16);
   butterfly_compu(&buff_c[4], &buff_c[6], w0);
   butterfly_compu(&buff_c[5], &buff_c[7], w16);
   butterfly_compu(&buff_c[8], &buff_c[10], w0);
   butterfly_compu(&buff_c[9], &buff_c[11], w16);
   butterfly_compu(&buff_c[12], &buff_c[14], w0);
   butterfly_compu(&buff_c[13], &buff_c[15], w16);
   butterfly_compu(&buff_c[16], &buff_c[18], w0);
   butterfly_compu(&buff_c[17], &buff_c[19], w16);
   butterfly_compu(&buff_c[20], &buff_c[22], w0);
   butterfly_compu(&buff_c[21], &buff_c[23], w16);
   butterfly_compu(&buff_c[24], &buff_c[26], w0);
   butterfly_compu(&buff_c[25], &buff_c[27], w16);
   butterfly_compu(&buff_c[28], &buff_c[30], w0);
   butterfly_compu(&buff_c[29], &buff_c[31], w16);
   butterfly_compu(&buff_c[32], &buff_c[34], w0);
   butterfly_compu(&buff_c[33], &buff_c[35], w16);
   butterfly_compu(&buff_c[36], &buff_c[38], w0);
   butterfly_compu(&buff_c[37], &buff_c[39], w16);
   butterfly_compu(&buff_c[40], &buff_c[42], w0);
   butterfly_compu(&buff_c[41], &buff_c[43], w16);
   butterfly_compu(&buff_c[44], &buff_c[46], w0);
   butterfly_compu(&buff_c[45], &buff_c[47], w16);
   butterfly_compu(&buff_c[48], &buff_c[50], w0);
   butterfly_compu(&buff_c[49], &buff_c[51], w16);
   butterfly_compu(&buff_c[52], &buff_c[54], w0);
   butterfly_compu(&buff_c[53], &buff_c[55], w16);
   butterfly_compu(&buff_c[56], &buff_c[58], w0);
   butterfly_compu(&buff_c[57], &buff_c[59], w16);
   butterfly_compu(&buff_c[60], &buff_c[62], w0);
   butterfly_compu(&buff_c[61], &buff_c[63], w16);
//第3轮运算
   butterfly_compu(&buff_c[0], &buff_c[4], w0);
   butterfly_compu(&buff_c[1], &buff_c[5], w8);
   butterfly_compu(&buff_c[2], &buff_c[6], w16);
   butterfly_compu(&buff_c[3], &buff_c[7], w24);
   butterfly_compu(&buff_c[8], &buff_c[12], w0);
   butterfly_compu(&buff_c[9], &buff_c[13], w8);
   butterfly_compu(&buff_c[10], &buff_c[14], w16);
   butterfly_compu(&buff_c[11], &buff_c[15], w24);
   butterfly_compu(&buff_c[16], &buff_c[20], w0);
   butterfly_compu(&buff_c[17], &buff_c[21], w8);
   butterfly_compu(&buff_c[18], &buff_c[22], w16);
   butterfly_compu(&buff_c[19], &buff_c[23], w24);
   butterfly_compu(&buff_c[24], &buff_c[28], w0);
   butterfly_compu(&buff_c[25], &buff_c[29], w8);
   butterfly_compu(&buff_c[26], &buff_c[30], w16);
   butterfly_compu(&buff_c[27], &buff_c[31], w24);
   butterfly_compu(&buff_c[32], &buff_c[36], w0);
   butterfly_compu(&buff_c[33], &buff_c[37], w8);
   butterfly_compu(&buff_c[34], &buff_c[38], w16);
   butterfly_compu(&buff_c[35], &buff_c[39], w24);
   butterfly_compu(&buff_c[40], &buff_c[44], w0);
   butterfly_compu(&buff_c[41], &buff_c[45], w8);
   butterfly_compu(&buff_c[42], &buff_c[46], w16);
   butterfly_compu(&buff_c[43], &buff_c[47], w24);
   butterfly_compu(&buff_c[48], &buff_c[52], w0);
   butterfly_compu(&buff_c[49], &buff_c[53], w8);
   butterfly_compu(&buff_c[50], &buff_c[54], w16);
   butterfly_compu(&buff_c[51], &buff_c[55], w24);
   butterfly_compu(&buff_c[56], &buff_c[60], w0);
   butterfly_compu(&buff_c[57], &buff_c[61], w8);
   butterfly_compu(&buff_c[58], &buff_c[62], w16);
   butterfly_compu(&buff_c[59], &buff_c[63], w24);
//第4轮运算
   butterfly_compu(&buff_c[0], &buff_c[8], w0);
   butterfly_compu(&buff_c[1], &buff_c[9], w4);
   butterfly_compu(&buff_c[2], &buff_c[10], w8);
   butterfly_compu(&buff_c[3], &buff_c[11], w12);
   butterfly_compu(&buff_c[4], &buff_c[12], w16);
   butterfly_compu(&buff_c[5], &buff_c[13], w20);
   butterfly_compu(&buff_c[6], &buff_c[14], w24);
   butterfly_compu(&buff_c[7], &buff_c[15], w28);
   butterfly_compu(&buff_c[16], &buff_c[24], w0);
   butterfly_compu(&buff_c[17], &buff_c[25], w4);
   butterfly_compu(&buff_c[18], &buff_c[26], w8);
   butterfly_compu(&buff_c[19], &buff_c[27], w12);
   butterfly_compu(&buff_c[20], &buff_c[28], w16);
   butterfly_compu(&buff_c[21], &buff_c[29], w20);
   butterfly_compu(&buff_c[22], &buff_c[30], w24);
   butterfly_compu(&buff_c[23], &buff_c[31], w28);
   butterfly_compu(&buff_c[32], &buff_c[40], w0);
   butterfly_compu(&buff_c[33], &buff_c[41], w4);
   butterfly_compu(&buff_c[34], &buff_c[42], w8);
   butterfly_compu(&buff_c[35], &buff_c[43], w12);
   butterfly_compu(&buff_c[36], &buff_c[44], w16);
   butterfly_compu(&buff_c[37], &buff_c[45], w20);
   butterfly_compu(&buff_c[38], &buff_c[46], w24);
   butterfly_compu(&buff_c[39], &buff_c[47], w28);
   butterfly_compu(&buff_c[48], &buff_c[56], w0);
   butterfly_compu(&buff_c[49], &buff_c[57], w4);
   butterfly_compu(&buff_c[50], &buff_c[58], w8);
   butterfly_compu(&buff_c[51], &buff_c[59], w12);
   butterfly_compu(&buff_c[52], &buff_c[60], w16);
   butterfly_compu(&buff_c[53], &buff_c[61], w20);
   butterfly_compu(&buff_c[54], &buff_c[62], w24);
   butterfly_compu(&buff_c[55], &buff_c[63], w28);
//第5轮运算
   butterfly_compu(&buff_c[0], &buff_c[16], w0);
   butterfly_compu(&buff_c[1], &buff_c[17], w2);
   butterfly_compu(&buff_c[2], &buff_c[18], w4);
   butterfly_compu(&buff_c[3], &buff_c[19], w6);
   butterfly_compu(&buff_c[4], &buff_c[20], w8);
   butterfly_compu(&buff_c[5], &buff_c[21], w10);
   butterfly_compu(&buff_c[6], &buff_c[22], w12);
   butterfly_compu(&buff_c[7], &buff_c[23], w14);
   butterfly_compu(&buff_c[8], &buff_c[24], w16);
   butterfly_compu(&buff_c[9], &buff_c[25], w18);
   butterfly_compu(&buff_c[10], &buff_c[26], w20);
   butterfly_compu(&buff_c[11], &buff_c[27], w22);
   butterfly_compu(&buff_c[12], &buff_c[28], w24);
   butterfly_compu(&buff_c[13], &buff_c[29], w26);
   butterfly_compu(&buff_c[14], &buff_c[30], w28);
   butterfly_compu(&buff_c[15], &buff_c[31], w30);
   butterfly_compu(&buff_c[32], &buff_c[48], w0);
   butterfly_compu(&buff_c[33], &buff_c[49], w2);
   butterfly_compu(&buff_c[34], &buff_c[50], w4);
   butterfly_compu(&buff_c[35], &buff_c[51], w6);
   butterfly_compu(&buff_c[36], &buff_c[52], w8);
   butterfly_compu(&buff_c[37], &buff_c[53], w10);
   butterfly_compu(&buff_c[38], &buff_c[54], w12);
   butterfly_compu(&buff_c[39], &buff_c[55], w14);
   butterfly_compu(&buff_c[40], &buff_c[56], w16);
   butterfly_compu(&buff_c[41], &buff_c[57], w18);
   butterfly_compu(&buff_c[42], &buff_c[58], w20);
   butterfly_compu(&buff_c[43], &buff_c[59], w22);
   butterfly_compu(&buff_c[44], &buff_c[60], w24);
   butterfly_compu(&buff_c[45], &buff_c[61], w26);
   butterfly_compu(&buff_c[46], &buff_c[62], w28);
   butterfly_compu(&buff_c[47], &buff_c[63], w30);
//第6轮运算
   butterfly_compu(&buff_c[0], &buff_c[32], w0);
   butterfly_compu(&buff_c[1], &buff_c[33], w1);
   butterfly_compu(&buff_c[2], &buff_c[34], w2);
   butterfly_compu(&buff_c[3], &buff_c[35], w3);
   butterfly_compu(&buff_c[4], &buff_c[36], w4);
   butterfly_compu(&buff_c[5], &buff_c[37], w5);
   butterfly_compu(&buff_c[6], &buff_c[38], w6);
   butterfly_compu(&buff_c[7], &buff_c[39], w7);
   butterfly_compu(&buff_c[8], &buff_c[40], w8);
   butterfly_compu(&buff_c[9], &buff_c[41], w9);
   butterfly_compu(&buff_c[10], &buff_c[42], w10);
   butterfly_compu(&buff_c[11], &buff_c[43], w11);
   butterfly_compu(&buff_c[12], &buff_c[44], w12);
   butterfly_compu(&buff_c[13], &buff_c[45], w13);
   butterfly_compu(&buff_c[14], &buff_c[46], w14);
   butterfly_compu(&buff_c[15], &buff_c[47], w15);
   butterfly_compu(&buff_c[16], &buff_c[48], w16);
   butterfly_compu(&buff_c[17], &buff_c[49], w17);
   butterfly_compu(&buff_c[18], &buff_c[50], w18);
   butterfly_compu(&buff_c[19], &buff_c[51], w19);
   butterfly_compu(&buff_c[20], &buff_c[52], w20);
   butterfly_compu(&buff_c[21], &buff_c[53], w21);
   butterfly_compu(&buff_c[22], &buff_c[54], w22);
   butterfly_compu(&buff_c[23], &buff_c[55], w23);
   butterfly_compu(&buff_c[24], &buff_c[56], w24);
   butterfly_compu(&buff_c[25], &buff_c[57], w25);
   butterfly_compu(&buff_c[26], &buff_c[58], w26);
   butterfly_compu(&buff_c[27], &buff_c[59], w27);
   butterfly_compu(&buff_c[28], &buff_c[60], w28);
   butterfly_compu(&buff_c[29], &buff_c[61], w29);
   butterfly_compu(&buff_c[30], &buff_c[62], w30);
   butterfly_compu(&buff_c[31], &buff_c[63], w31);
    for (size_t i = 0; i < 64; i++)
    {
        *(buff + i * 2) = buff_c[i].re;
        *(buff + i * 2 + 1) = buff_c[i].im;
    }
    free(buff_c);
}
